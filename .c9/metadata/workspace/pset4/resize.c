{"filter":false,"title":"resize.c","tooltip":"/pset4/resize.c","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":128,"column":1},"action":"insert","lines":["#include <stdio.h>","#include <stdlib.h>","","#include \"bmp.h\"","","int main(int argc, char* argv[])","{","\t\t// ensure proper usage","\t\tif (argc != 4)","\t\t{","\t\t\t\tprintf(\"Usage:resize n infile outfile\\n\");","\t\t\t\treturn 1;","\t\t}","","\t\t// Check the resize factor","\t\tint factor = atoi(argv[1]);","\t\tif(factor < 0 || factor > 100)","\t\t{","\t\t\t\tprintf(\"The resize factor should be a positive integer <= 100.\\n\");","\t\t\t\treturn 2;","\t\t}","","\t\t// remember filenames and factor ","\t\tchar* infile = argv[2];","\t\tchar* outfile = argv[3];","","\t\t// open input file ","\t\tFILE* inptr = fopen(infile, \"r\");","\t\tif (inptr == NULL)","\t\t{","\t\t\t\tprintf(\"Could not open %s.\\n\", infile);","\t\t\t\treturn 3;","\t\t}","","\t\t// open output file","\t\tFILE* outptr = fopen(outfile, \"w\");","\t\tif (outptr == NULL)","\t\t{","\t\t\t\tfclose(inptr);","\t\t\t\tfprintf(stderr, \"Could not create %s.\\n\", outfile);","\t\t\t\treturn 4;","\t\t}","","\t\t// read infile's BITMAPFILEHEADER","\t\tBITMAPFILEHEADER bf;","\t\tfread(&bf, sizeof(BITMAPFILEHEADER), 1, inptr);","","\t\t// read infile's BITMAPINFOHEADER","\t\tBITMAPINFOHEADER bi;","\t\tfread(&bi, sizeof(BITMAPINFOHEADER), 1, inptr);","","\t\t// ensure infile is (likely) a 24-bit uncompressed BMP 4.0","\t\tif (bf.bfType != 0x4d42 || bf.bfOffBits != 54 || bi.biSize != 40 || ","\t\t\t\t\t\tbi.biBitCount != 24 || bi.biCompression != 0)","\t\t{","\t\t\t\tfclose(outptr);","\t\t\t\tfclose(inptr);","\t\t\t\tfprintf(stderr, \"Unsupported file format.\\n\");","\t\t\t\treturn 4;","\t\t}","","\t\t// construct bitmap headers for the outfile","\t\tBITMAPFILEHEADER out_bf;","\t\tBITMAPINFOHEADER out_bi;\t","\t\tout_bf = bf;","\t\tout_bi = bi;","\t\tout_bi.biWidth = bi.biWidth * factor;","\t\tout_bi.biHeight = bi.biHeight * factor;","","\t\t// determine padding for scanlines","\t\t// Needed for SizeImage calculation","\t\tint in_padding =  (4 - (bi.biWidth * sizeof(RGBTRIPLE)) % 4) % 4;","\t\tint out_padding =  (4 - (out_bi.biWidth * sizeof(RGBTRIPLE)) % 4) % 4;","","\t\t// Calculate file and image size","\t\t// Kudos for the folks at https://code.google.com/p/kupl09/ for suggesting the formula for ","\t\t// biSizeImage calculation.","\t\tout_bf.bfSize = 54 + out_bi.biWidth * abs(out_bi.biHeight) * 3 + abs(out_bi.biHeight) *  out_padding;","\t\tout_bi.biSizeImage = ((((out_bi.biWidth * out_bi.biBitCount) + 31) & ~31) / 8) * abs(out_bi.biHeight);","","\t\t// write outfile's BITMAPFILEHEADER","\t\tfwrite(&out_bf, sizeof(BITMAPFILEHEADER), 1, outptr);","","\t\t// write outfile's BITMAPINFOHEADER","\t\tfwrite(&out_bi, sizeof(BITMAPINFOHEADER), 1, outptr);","","\t\tfor (int i = 0, biHeight = abs(bi.biHeight); i < biHeight; i++)","\t\t{","\t\t\t\t// Write each line factor-times","\t\t\t\tfor(int n = 0; n < factor; n++)","\t\t\t\t{","\t\t\t\t\t\t// iterate over pixels in scanline","\t\t\t\t\t\tfor (int j = 0; j < bi.biWidth; j++)","\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t// temporary storage","\t\t\t\t\t\t\t\tRGBTRIPLE triple;","","\t\t\t\t\t\t\t\t// read RGB triple from infile","\t\t\t\t\t\t\t\tfread(&triple, sizeof(RGBTRIPLE), 1, inptr);","","\t\t\t\t\t\t\t\t// write RGB triple to outfile","\t\t\t\t\t\t\t\tfor(int m = 0; m < factor; m++) ","\t\t\t\t\t\t\t\t{","\t\t\t\t\t\t\t\t\t\tfwrite(&triple, sizeof(RGBTRIPLE), 1, outptr);","\t\t\t\t\t\t\t\t}","\t\t\t\t\t\t}","","\t\t\t\t\t\t// skip over padding in infile","\t\t\t\t\t\tfseek(inptr, in_padding, SEEK_CUR);","","\t\t\t\t\t\t// then add it to outfile","\t\t\t\t\t\tfor (int k = 0; k <out_padding; k++)","\t\t\t\t\t\t\t\tfputc(0x00, outptr);","","\t\t\t\t\t\tfseek(inptr, -(bi.biWidth * 3 + in_padding ), SEEK_CUR);","","\t\t\t\t}","\t\t\t\tfseek(inptr, bi.biWidth*3+in_padding, SEEK_CUR);","\t\t}","","\t\t// close infile","\t\tfclose(inptr);","","\t\t// close outfile","\t\tfclose(outptr);","","\t\t// that's all folks","\t\treturn 0;","}"],"id":1}]]},"ace":{"folds":[],"scrolltop":1617,"scrollleft":0,"selection":{"start":{"row":0,"column":0},"end":{"row":128,"column":1},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":100,"state":"start","mode":"ace/mode/c_cpp"}},"timestamp":1457529489435,"hash":"b3edcdbef2b1f549b3d8c1cee09bdd3264cf8975"}